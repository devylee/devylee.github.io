{%- if page.layout == 'post' -%}
{%- capture body_class -%}post-template{% for tag in page.tags %} tag-{{tag|downcase}}{% endfor %}{%- endcapture -%}
{%- elsif page.layout == 'page' -%}
{%- capture body_class -%}page-template page-{{page.current}}{%- endcapture -%}
{%- elsif page.tag -%}
{%- capture body_class -%}tag-template tag-{{page.tag|downcase}}{%- endcapture -%}
{%- elsif page.author -%}
{%- capture body_class -%}author-template author-{{page.author}}{%- endcapture -%}
{%- else -%}
{%- assign body_class = 'home-template' -%}
{%- endif -%}
<!DOCTYPE html>
<html>
<head>
    
{%- comment -%} Document Settings ]] {%- endcomment -%}
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

{%- comment -%} Styles'n'Scripts {%- endcomment -%}
    <link rel="stylesheet" type="text/css" href="{{ 'assets/built/screen.css' | relative_url }}" />
    <link rel="stylesheet" type="text/css" href="{{ 'assets/css/customize.css' | relative_url }}" />
    <link rel="stylesheet" type="text/css" href="{{ 'assets/css/syntax.css' | relative_url }}" />

    {% include head.html %}

</head>
<body class="{{body_class}}">

    <div class="site-wrapper">

{% comment %} All the main content gets inserted here {% endcomment %}
        {{ content }}

{% comment %} The footer at the very bottom of the screen {% endcomment %}
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright">
                    <a href="{{ '/' | relative_url }}">{{ site.name }}</a> 
                    &copy; {{  site.time | date: '%Y' }} 
                    <nobr>All Rights Reserved.</nobr>
                </section>
                <nav class="site-footer-nav">
                    <a href="https://jekyllrb.com/">Proudly published with Jekyll</a>
                    <a href="https://pages.github.com/">Hosted by Github Pages</a>
                    <a href="https://github.com/tryghost/casper">Theme by Casper</a>
                </nav>
            </div>
        </footer>

    </div>

{% comment %} jQuery + Fitvids, which makes all video embeds responsive ]] {% endcomment %}
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="{{ '/assets/js/jquery.fitvids.js' | relative_url }}"></script>
    
    {%- assign posts_pages = site.posts | size | divided_by:10 | plus:1 -%}
    
    {% if posts_pages > 0 %}
    <script>
        var maxPages = parseInt('{{posts_pages}}');
    </script>
    <script src="{{ '/assets/js/infinitescroll.js' | relative_url }}"></script>
    {% endif %}
    
    {% if jekyll.environment == "production" and site.google_analytics %}
        {% include google_analytics.html %}   
    {% endif %}

    {% if layout.current == 'post' %}
    <script type="text/javascript" src="{{ '/assets/js/ping.js' | relative_url }}"></script>
    <script>

    // NOTE: Scroll performance is poor in Safari
    // - this appears to be due to the events firing much more slowly in Safari.
    //   Dropping the scroll event and using only a raf loop results in smoother
    //   scrolling but continuous processing even when not scrolling
    $(document).ready(function () {
        // Start fitVids
        var $postContent = $(".post-full-content");
        $postContent.fitVids();
        // End fitVids

        var progressBar = document.querySelector('progress');
        var header = document.querySelector('.floating-header');
        var title = document.querySelector('.post-full-title');

        var lastScrollY = window.scrollY;
        var lastWindowHeight = window.innerHeight;
        var lastDocumentHeight = $(document).height();
        var ticking = false;

        function onScroll() {
            lastScrollY = window.scrollY;
            requestTick();
        }

        function onResize() {
            lastWindowHeight = window.innerHeight;
            lastDocumentHeight = $(document).height();
            requestTick();
        }

        function requestTick() {
            if (!ticking) {
                requestAnimationFrame(update);
            }
            ticking = true;
        }

        function update() {
            var trigger = title.getBoundingClientRect().top + window.scrollY;
            var triggerOffset = title.offsetHeight + 35;
            var progressMax = lastDocumentHeight - lastWindowHeight;

            // show/hide floating header
            if (lastScrollY >= trigger + triggerOffset) {
                header.classList.add('floating-active');
            } else {
                header.classList.remove('floating-active');
            }

            progressBar.setAttribute('max', progressMax);
            progressBar.setAttribute('value', lastScrollY);

            ticking = false;
        }

        window.addEventListener('scroll', onScroll, {passive: true});
        window.addEventListener('resize', onResize, false);

        update();
    });
    </script>
    {% elsif layout.current == 'page' %}
    <script>
        $(function() {
            var $postContent = $(".post-full-content");
            $postContent.fitVids();
        });
    </script>
    {% endif %}
</body>
</html>

